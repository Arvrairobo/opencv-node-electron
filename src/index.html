<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>opencv-node-electron</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
</head>
<body>
<canvas id="canvas-video" style="width: 100%; height: 100%"></canvas>
<pre style="word-break: break-all;" id="emotions"></pre>
<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>
    // MODIFY THIS TO THE APPROPRIATE URL IF IT IS NOT BEING RUN LOCALLY
    var socket = io.connect('http://localhost:3000');

    var canvas = document.getElementById('canvas-video');
    var context = canvas.getContext('2d');
    var img = new Image();

    // show loading notice
    context.fillStyle = '#333';
    context.fillText('Loading...', canvas.width / 2 - 30, canvas.height / 3);

    socket.on('frame', function (data) {
        var uint8Arr = new Uint8Array(data.buffer);
        var str = String.fromCharCode.apply(null, uint8Arr);
        var base64String = btoa(str);

        img.onload = function () {
            context.drawImage(this, 0, 0, canvas.width, canvas.height);
        };
        img.src = 'data:image/png;base64,' + base64String;
    });

    var emotions = document.getElementById('emotions');
    socket.on('emotions', function(data){
        emotions.innerHTML = JSON.stringify(data);
    })
</script>
</body>

</html>
